
<html>

<head>

	<link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" />
	<script src="../js/jquery-1.10.1.min.js"></script>
	<script src="../js/creative_coding.js"></script>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyDEKAnXP_v0EOZxJ5bv0K4UNqYFRM1JAj0&libraries=visualization"></script>

	<script language="javascript" src="../js/canvas.js"></script>
	<script language="javascript" src="../js/d3.js"></script>
	<script language="javascript" src="../js/simplex-noise.js"></script>
	<script src="../js/CanvasLayer.js"></script>
	<script src="../js/infobubble.js"></script>
	<script src="../js/map_styles.js"></script>

	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>

body { line-height: 18px; font-size: 16px;}

.info_content { font-size: 15px; }
.info_content h3 { font-weight: bold; }
.info_content h4 { font-style: italic; }

.info_date {
	background: #000;
	color: #fff;
	padding: 0 4px 2px 4px;
	display: inline-block;
	margin-bottom: 4px;
}

.info_injuries {
	//color: red;
}

canvas {
	pointer-events:none;
	position: absolute;
}


.highlight {
 color: #9fc8f0;
}

.bullet {
	color: #333;
	vertical-align: bottom;
	padding-left: 1px;
	font-size: 22px;
}

.bullet.active{
	color: red;
}

.ok .bullet.active{
	color: green;
}

.injured .bullet.active{
	color: orange;
}

#days .night .bullet.active{
	color: yellow;
}
#days .day .bullet.active{
	color: #00aef0;
}



#pedestrians .bullet.active{
	color: #e4a478;
}

#cyclists .bullet.active{
	color: #b8d072;
}

#motorists .bullet.active{
	color: #496b8e;
}

#days .bullet.active{
	color: #9fc8f0;
}

h2 { font-weight: 600; margin-bottom: 6px; display: inline;}
h1 { font-weight: 400; padding-top: 16px; font-size: 18px;}

.holder {
	width: 320px;
	font-weight: 100;
	position: absolute;
	z-index: 1; top: 0px; right: 0px;
	background: rgba(0,0,0,0.8); color: #fff;
	padding: 0px 24px 0 40px;
	line-height: 16px;
	font-size: 14px;
	height: 100%;
	transition-property: all;
	transition-duration: .5s;
	transition-timing-function: cubic-bezier(0, 1, 0.5, 1);
}

.holder.hidden {
	right: -345px;
	background: rgba(255,255,255,0.1); color: #000;
}

.holder.day {
	background: rgba(255,255,255,0.8); color: #000;
	border: 1px #eee solid;
}

.close {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 20px;
  font-weight: bold;
  line-height: 18px;
  color: #fff;
  text-shadow: 0 1px 0 #333;
  opacity: 0.6;
  filter: alpha(opacity=60);
  text-decoration: none;
	float: left;
	margin: 10px 0 10px -27px;
}

.close:hover {
  color: #eee;
  text-decoration: none;
  opacity: 0.4;
  filter: alpha(opacity=40);
  cursor: pointer;
}

.bold {
	font-weight: 600;
}

#date_holder {
	/*position: absolute; top: 30px; left: 40px;
	z-index: 4;*/
	color: #fff;
	line-height: 22px;
}

</style>
</head>

<body>

<div id="map"></div>

<div class="holder">

	 <a class="close">Ã—</a> <br>

	 <h1 id="date_holder" class="add-bottom<br>">
		 A Month of New York Traffic Accidents <br>
	 </h1>


		<div class= "half-bottom  add-top bold">Viz Type: </div>

		<form name="viz_selector">
			<input type="radio" name="group1" checked value="1"> Influence
			<input type="radio" name="group1" value="2"> Density
			<!-- <input type="radio" name="group1" value="3"> Density <br> -->
			<input type="radio" name="group1" value="4"> HeatMap <br>
			<input type="radio" name="group1" value="5"> Ok/Not Ok
			<input type="radio" name="group1" value="6"> Type <br>
			<input type="radio" name="group1" value="7"> Day vs Night
			<input type="radio" name="group1" value="8"> Day of Week
		</form>
		<!-- <select id="type" name="select" onchange="filter()">
			<option value="1" selected>Influence</option>
			<option value="2">Density</option>
			<option value="3">Points</option>
			<option value="4">HeatMap</option>
			<option value="5">Cross</option>
			<option value="6">Type</option>
			<option value="7">Day vs Night</option>
			<option value="8">Day of Week</option>
		</select> <br> -->


	<div class= "half-bottom add-top bold">Filter: </div>

	<div id="all" class="highlight half-bottom">
		<input type="checkbox" checked id="all_accidents">
		<span class="total"><h2>All Accidents: <span class="count">0 </h2></span><br>

		<input type="checkbox" checked id="total_injured">
		<span class="injured"> <span class="bullet">&bullet;</span>
		<span class="count">0 </span> Injured </span><br>

		<span class="killed"><input type="checkbox" checked id="total_killed">
			<span class="bullet">&bullet;</span>
			<span class="count">0 </span> Killed </span><br>

		<span class="ok"><input type="checkbox" checked id="ok_checked">
			<span class="bullet">&bullet;</span>
			<span class="count">0 </span>  OK </span><br>

	</div>

	<div id="pedestrians" class = "half-bottom">

	<input type="checkbox" checked id="pedestrians_checked">
	<h2>Pedestrians</h2> <br>

	<span class="injured"><input type="checkbox" checked id="pedestrians_injured">
		<span class="bullet">&bullet;</span>
		<span class="count">0 </span> Injured </span><br>

	<span class="killed"><input type="checkbox" checked id="pedestrians_killed">
		<span class="bullet">&bullet;</span>
		<span class="count">0 </span> Killed </span><br>

	</div>

	<div id="cyclists"  class = "half-bottom">

		<input type="checkbox" checked id="cyclists_checked">
		<h2>Cyclists</h2> <br>

		<span class="injured"><input type="checkbox" checked id="cyclists_injured">   <span class="bullet">&bullet;</span>
		<span class="count">0 </span> Injured </span><br>

		<span class="killed"><input type="checkbox" checked id="cyclists_killed">
			<span class="bullet">&bullet;</span>
			<span class="count">0 </span> Killed </span><br>

	</div>

	<div id="motorists"  class = "half-bottom">

		<input type="checkbox" checked id="motorists_checked">
		<h2>Motorists</h2> <br>

		<span class="injured"><input type="checkbox" checked id="motorists_injured">  <span class="bullet">&bullet;</span>
		<span class="count">0 </span> Injured </span><br>

		<span class="killed"><input type="checkbox" checked id="motorists_killed">
			<span class="bullet">&bullet;</span>
			<span class="count">0 </span> Killed</span><br>

	</div>

	<div id='days'>

	<input type="checkbox" checked id="days_checked"> <h2>All Time</h2><br>

		<span class="day">
			<input type="checkbox" checked id="day_checked"> <span class="bullet">&bullet;</span>
			Day (6am - 6pm)</span><br>

		<span class="night">
			<input type="checkbox" checked id="night_checked"> <span class="bullet">&bullet;</span>
			Night (6pm - 6am)
		</span><br>

	 	<span class="mon">
		<input type="checkbox" checked id="mon_check">
		<span class="bullet">&bullet;</span>
		Mon: <span class="count">0</span>
		</span><br>

		<span class="tues">
		<input type="checkbox" checked id="tues_check">
		<span class="bullet">&bullet;</span>
		Tues: <span class="count">0</span>
		</span><br>

		<span class="wed">
		<input type="checkbox" checked id="wed_check">
		<span class="bullet">&bullet;</span>
		Wed: <span class="count">0</span>
		</span><br>

		<span class="thurs">
		<input type="checkbox" checked id="thurs_check">
		<span class="bullet">&bullet;</span>
		Thurs: <span class="count">0</span>
		</span><br>

		<span class="fri">
		<input type="checkbox" checked id="fri_check">
		<span class="bullet">&bullet;</span>
		Fri: <span class="count">0</span>
		</span><br>

		<span class="sat">
		<input type="checkbox" checked id="sat_check">
		<span class="bullet">&bullet;</span>
		Sat: <span class="count">0</span>
		</span><br>

		<span class="sun">
		<input type="checkbox" checked id="sun_check">
		<span class="bullet">&bullet;</span>
		Sun: <span class="count">0</span>
		</span><br>

	</div>


</div>




<script type="text/javascript">
var ctx;
var resolutionScale = window.devicePixelRatio || 1;

var ctx2 = createCanvas("canvas2");
var ctx3 = createCanvas("canvas3");

frameRate = 120;

var tt = "all";

var particles = [];

var colours = new colourPool()
	    .add("#496b8e")
	    .add("#71C152")
	    .add("#b8d072")
      .add("#e4a478")
			.add("#ec008c")
			.add("red")
			.add('#FF3300')
			.add('#FF6600')

var colours2 = new colourPool()
			.add("#3495ba")
			.add("#8bc4d5")
			.add("#b8d072")
			.add("#f2de6b")
			.add("#e7a278")
			.add("#dc776d")
			.add('#496b8e')
			//.add('#b8d072')
			.add('#ffffff')

var colours = new colourPool()
			.add("#3495ba")
			.add(rgba(110,229,49, 0.7))
			.add(rgba(255,255,0, 0.75))
			.add(rgba(255,116,0, 0.8))
			//.add(rgba(255,0,0, 0.85))
			.add("#e7a278")
			.add("#dc776d")
			.add('#496b8e');

// var colours2 = new colourPool()
// 		.add("#9ca9c4")
// 		.add("#91a0bd")
// 		.add("#7993c0")
// 		.add("#708ab4")
// 		.add("#6481a9")
// 		.add("#57779c")
// 		.add('#496b8e')
// 		.add('#ffffff')
// 		.add("#dc776d")
// 		.add('#496b8e')
// 		.add('#b8d072')
// 		.add('#f2de6b')



// console.log(colours);
// console.log(colours.get(0));

var filters = [];

var motorist_colour =  colours.get(0);
var ok_colour = colours.get(1);
var cyclist_colour = colours.get(2);
var pedestrian_colour = colours.get(3);
var injured_colour = colours.get(4);
var killed_colour = colours.get(5);

//console.log(motorist_colour);

var url = "../data/NYPD_Motor_Vehicle_Collisions-11-6-2017_10_7_2017.csv";

var c = 0;
var t = "any";
var f = "all";

var heatmapData = [];
var linecount = 0;
var day_start = 5;
var night_start = 18;

var seed = window.location.hash.substr(1) || String(Math.random()).split('.')[1]
var r = random( seed )
var simplex = new SimplexNoise( r )
var simplex3 = simplex.noise3D.bind(simplex)

var config = {
    margin: 0.9,
    activeLines : 0,
    line_width: 5,
    random : random,
    simplex3 : simplex3,
    maxAngle : Math.PI * 0.2,
    lineLength : 5,
    simplexScale : 0.2,
    simplexDepthScale : 0.001,
  }

	var x1 = w/2, y1 = h/2;
	var x2 = w/2, y2 = h/2;

	var s = rgb(randomInt(255), randomInt(255), randomInt(255));
	var lines = [];
	var active_lines = [];
	var was_hit, hit, curr_line_width;
	var simplex = new SimplexNoise();

	var total_accidents = 0, total_incidents = 0;
	var total_injured = 0, total_deaths = 0, total_ok = 0;
	var total_pedestrians_injured = 0, total_pedestrians_deaths = 0;
	var total_cyclists_injured = 0, total_cyclists_deaths = 0;
	var total_motorists_injured = 0, total_motorists_deaths = 0;
	var pedestrians_injured = 0, cyclists_injured = 0, motorists_injured = 0;
	var pedestrians_killed = 0, cyclists_killed = 0, motorists_killed = 0;

	var pedestrian = 0, cyclist = 0, motorist = 0, ok = 0;
	var injured = 0, killed = 0;

	var filter_motorist = true, filter_cyclist = true, filter_pedestrian = true;

	var monday = 0, tuesday = 0, wednesday = 0, thursday = 0, friday = 0, saturday = 0, sunday = 0;

	var gmap, heatmap, canvasLayer;
	var heatmap, data;

// STYLE GENERAL POI WINDOW

  var infoWindow = new InfoBubble({
      minHeight: 120,
      minWidth: 300,
      hideCloseButton: true,
      disableAutoPan: true,
      disableAnimation: true,
      backgroundColor: '#fff',
      borderRadius: 12,
      padding: 8,
      arrowSize: 10,
      borderWidth: 1,
      borderColor: '#ddd',
      maxWidth: 400
  }), d;

var markers = [];
var infowindows = [];

var tm = 0;
var count = 0;
var curve, change;
var viz = 1;
var mapLoaded = false;
var start_date = "";


function nextDataPoint(d){


		c = 0;
		var total = 0;
		updateUI(d);

		if(isCorrectTime(d) && isCorrectDay(d)){

			injured = 0, killed = 0;
			pedestrian = 0, cyclist = 0, motorist = 0, ok = 0;
			pedestrians_injured = 0, cyclists_injured = 0, motorists_injured = 0;
			pedestrians_killed = 0, cyclists_killed = 0, motorists_killed = 0;

			if (d['NUMBER OF PEDESTRIANS INJURED'] != undefined && parseInt(d['NUMBER OF PEDESTRIANS INJURED']) > 0) {

				var n = parseInt(d['NUMBER OF PEDESTRIANS INJURED']);
				total_pedestrians_injured += n;
				pedestrian += n;
				injured += n;
				pedestrians_injured += n;

			}

			if (d['NUMBER OF PEDESTRIANS KILLED'] != undefined && parseInt(d['NUMBER OF PEDESTRIANS KILLED']) > 0) {

				var n = parseInt(d['NUMBER OF PEDESTRIANS KILLED']);
				total_pedestrians_deaths += n;
				pedestrian += n;
				killed += n;
				pedestrians_killed += n;

			}

			if (d['NUMBER OF CYCLIST INJURED'] != undefined && parseInt(d['NUMBER OF CYCLIST INJURED']) > 0) {
				var n = parseInt(d['NUMBER OF CYCLIST INJURED']);
				total_cyclists_injured += n;
				cyclist += n;
				injured += n;
				cyclists_injured += n;
			}

			if(d['NUMBER OF CYCLIST KILLED'] != undefined && parseInt(d['NUMBER OF CYCLIST KILLED']) > 0) {
				var n = parseInt(d['NUMBER OF CYCLIST KILLED']);
				total_cyclists_deaths += n;
				cyclist += n;
				killed += n;
				cyclists_killed += n;
			}

			if(d['NUMBER OF MOTORIST INJURED'] != undefined && parseInt(d['NUMBER OF MOTORIST INJURED']) > 0) {
				var n = parseInt(d['NUMBER OF MOTORIST INJURED']);
				total_motorists_injured += n;
				motorist += n;
				injured += n;
				motorists_injured += n;
			}

			if(d['NUMBER OF MOTORIST KILLED'] != undefined && parseInt(d['NUMBER OF MOTORIST KILLED']) > 0) {
				var n = parseInt(d['NUMBER OF MOTORIST KILLED'])
				total_motorists_deaths += n;
				motorist += n;
				killed += n;
				motorists_killed += n;
			}

			if(killed == 0 && injured == 0) ok = 1;
			total_deaths += killed;
			total_injured += injured;
			var totals = motorist + cyclist + pedestrian;

			if(filters.includes('motorists_killed') && motorists_killed > 0) {
				total += motorists_killed;
				addMarker(d, counter);
				addViz(d, motorists_killed, 'motorists');
			}

			if(filters.includes('motorists_injured') && motorists_injured > 0) {
				total += motorists_injured;
				addViz(d, motorists_injured, 'motorists');
			}

			if(filters.includes('cyclists_killed') && cyclists_killed > 0) {
				total += cyclists_killed;
				addMarker(d, counter);
				addViz(d, cyclists_killed, 'cyclists');
			}
			if(filters.includes('cyclists_injured') && cyclists_injured > 0) {
				total += cyclists_injured;
				addViz(d, cyclists_injured, 'cyclists');
			}

			if(filters.includes('pedestrians_killed') && pedestrians_killed > 0) {
				total += pedestrians_killed;
				addMarker(d, counter);
				addViz(d, pedestrians_killed, 'pedestrians');
			}
			if(filters.includes('pedestrians_injured') && pedestrians_injured > 0) {
				total += pedestrians_injured;
				addViz(d, pedestrians_injured, 'pedestrians');
			}

			if(filters.includes('ok_checked') && pedestrians_injured == 0
			&& pedestrians_injured == 0 && pedestrians_killed == 0
			&& cyclists_injured == 0 && cyclists_killed == 0
			&& motorists_injured == 0 && motorists_killed == 0
			){
				addViz(d, 1, 'ok');
			}

		}
		//else {
		//resetLine();
		//}

	}

	function addViz(d, num, type){

		if(viz == 4) {
			addHeatMapData(d, num)
		} else if(viz == 1) {
			addLine(d);
		} else if(viz == 2 || viz == 3 || viz == 5 || viz == 6 || viz == 7 || viz == 8){
			addCircle(d, num, type);
		}

	}


	function isCorrectDay(d){
		var dt = d.TIME + " " + d.DATE;
		var day_number = getDayNumber(dt);
		if((filters.includes("sun_check") && day_number == 0)
		|| (filters.includes("mon_check") && day_number == 1)
		|| (filters.includes("tues_check") && day_number == 2)
		|| (filters.includes("wed_check") && day_number == 3)
		|| (filters.includes("thurs_check") && day_number == 4)
		|| (filters.includes("fri_check") && day_number == 5)
		|| (filters.includes("sat_check") && day_number == 6)
		|| (!filters.includes("sun_check") && !filters.includes("mon_check") && !filters.includes("tues_check") && !filters.includes("wed_check") && !filters.includes("thurs_check") && !filters.includes("fri_check") && !filters.includes("sat_check"))
		){
			return true;
		}
	}

	function isCorrectTime(d){
		var dt = d.TIME + " " + d.DATE;
		var day_type = getDayType(dt);

		if((filters.includes('day_checked') && isDay(dt))
		|| (filters.includes('night_checked') && !isDay(dt))
		|| (!filters.includes('day_checked') && !filters.includes('night_checked'))
		){
			return true;
		}
	}

	function resetLine(){

		if(data.length >0 && counter < data.length-1) {

			var d = data[counter];
			nextDataPoint(data[counter]);
			counter++;

			if(viz == 1) {
				active_lines.push(lines);
				linecount = 15;
			}

		}
	}




function filter() {

	filters = [];
	$('input[type=checkbox]').each(function () {
		if (this.checked) filters.push(this.id);
	});

	//console.log(viz);
	console.log(filters);

	if(data) {

		counter = 0;
		resetMap();
		deleteMarkers();

		if(viz == 4) addHeatmap();
		resetLine();

	}
}

// function highlightFilteredSection(){
// 	$("#all").removeClass('highlight');
// 	$("#pedestrians").removeClass('highlight');
// 	$("#cyclists").removeClass('highlight');
// 	$("#motorists").removeClass('highlight');
// 	$("#"+f).addClass('highlight');
// }




function draw() {

	if(data && data.length >0 ) {

		if(viz == 1) {
			twirl();
		} else {
			ctx.clearRect(0, 0, w, h);
			updateParticles();
		}

	}

}


function updateParticles(){
	//console.log(particles.length);
	if(viz == 8) {
		resetLine();
		resetLine();
		resetLine();
		resetLine();
		resetLine();
		resetLine();
		resetLine();
		resetLine();
	} else if (viz == 4 || viz == 6 || viz == 7) {
		resetLine();
		resetLine();
		resetLine();
		resetLine();
	} else if (viz == 2) {
		resetLine();
		resetLine();
	} else if (viz == 3 || viz == 5) {
		resetLine();
		resetLine();
		resetLine();
	}

	for (var i = 0; i < particles.length; i++) {

		var p = particles[i];
		p.update();
		p.draw();

	}
}


function addLine(d){

	var pos = getLocs(d);
	x = pos.x;
	y = pos.y;
	counter++;
	lines = [];
	x1 = x;
	y1 = y;
	x2 = x1, y2 = y1;
	curve = random(-0.3, 0.3);
	change = random(-0.01, 0.01);

	if (config.line_width > 0.1) config.line_width -=0.004;

	curr_line_width = config.line_width;

	if( t == day_start) {
		s = rgb(255 - randomInt(100,250));
	} else {
		s = rgb(randomInt(100,250));
	}

}


function addCircle(d, num, type){
	//console.log(type);
	var pos = getLocs(d);
		x = pos.x;
		y = pos.y;
		var dt = d.DATE + " "+ d.TIME;

		if(isDay(dt)) {
			c = rgb(255 - randomInt(100,250));
		} else {
			c = rgb(randomInt(100,250));
		}
		if (viz == 5) {
			if(type == "ok") {
				c = rgb(80);
			} else {
				c = rgb(240);
			}

		}
		if (viz == 7) {

			if(!isDay(dt)) {
				c = "yellow";
			} else {
				c = "#00aef0";
			}
		}
		counter++;

		var p = new Particle(x, y, c, d, num, type);

		if(viz == 6 || viz == 7 || viz == 2 || viz == 8) {
			particles.push(p);
		} else if(!isOverlapping(p)) {
			particles.push(p);
		}
		//else {
		//resetLine();
		//}
	}


function isOverlapping(p2){

	var hit = false;

	for (var i = 0; i < particles.length; i++) {

		var p = particles[i];

		if(p.show && p2.show && p.me != p2.me
			&& (viz == 8 && dist(p.x, p.y, p2.x, p2.y) < p.sticky_sz ||
			viz != 8 && dist(p.x, p.y, p2.x, p2.y) <= (p.sz/2 + p2.sz/2)
			)) {

			hit = true;

			if(viz == 2) {

				if(p2.sz >= p.sz ) {

					p2.sz += p.sz/5;
					if (p2.sz > p2.max_size) p2.sz = p2.max_size;
					p.show = false;
					//p2.c = "orange";

				} else {

					p.sz += p2.sz/2;
					if (p.sz > p.max_size) p.sz = p.max_size;
					p2.show = false;

				}

			} else if(viz == 8) {

				if(p.day == p2.day) {

					if (p2.sz >= p.sz ) {

						p2.sz += p.sz/2;
						if (p2.sz > p2.max_size) p2.sz = p2.max_size;
						p.show = false;
						//p2.c = "orange";

					} else if( p2.sz < p.sz ) {

						p.sz += p2.sz/2;
						if (p.sz > p.max_size) p.sz = p.max_size;
						p2.show = false;

					}
				if (p.sz >= p2.sz) {
					p.show = true;
					p2.show = false;
				} else {
					p2.show = true;
					p.show = false;
				}
				resetLine();
				}


			}
			return hit;
		}
	}
}


var Particle = function(x, y, c, d, num, type){

	this.x = x || w/2;
	this.y = y || h/2;
	this.c = c || rgb(random(255));
	this.sz = 1 + num * 2;
	if(viz == 5) {
		this.max_size = randomInt(20, 25);
	} else {
		this.max_size = randomInt(30, 40);
	}
	this.on = true;
	this.show = true;
	this.me = frameCount;
	var dt = d.DATE + " " + d.TIME;
	var date = new Date(dt)
	this.day = date.getDay();
	if (this.day == 0) this.day = 7;

	if(viz == 6) {
		this.on = false;
		this.sz = 10;

		if(type == 'motorists'){
			this.c = motorist_colour;
		} else if(type == 'cyclists'){
			this.c = cyclist_colour;
		} else if(type == 'pedestrians'){
			this.c = pedestrian_colour;
		} else {
			this.c = rgba(0, 0);
		}

	}

	if(viz == 2) {
		this.on = false;
		this.sz += 1;
	}

	if(viz == 5) {
		this.on = false;
		this.sz = 4 + this.sz;
	}

	if(viz == 3) {
		this.sz = 4;
		this.on = false;
	}

	if(viz == 7) {
		//this.sz = 3;
		this.on = false;
	}

	if(viz == 8) {
		//this.sz = 10;
		this.sticky_sz = 10;
		this.c = colours2.get(this.day);
	}


	this.update = function(){

		if(viz == 2) {
			//hitTest(this);
			isOverlapping(this);
		} else if((viz == 8) && this.show) {
			isOverlapping(this);
		} else if(this.on && isOverlapping(this)) {
			this.on = false;
			resetLine();
		}

		if(this.show && this.on && this.sz < 30) {
			this.sz += 0.02;
		} else if (this.on && this.sz >= 30){
			this.on = false;
			//resetLine();
		}

	}


	this.draw = function(){

		if(viz == 2 && this.show) {
			ctx.strokeStyle = this.c;
			ctx.lineWidth = 1;
			ctx.strokeEllipse(this.x, this.y, this.sz, this.sz);
		} else if (viz == 3){
			ctx.fillStyle = this.c;
			ctx.fillEllipse(this.x, this.y, this.sz, this.sz);
		} else if (viz == 5){
			ctx.fillStyle = this.c;
			ctx.cross(this.x, this.y, this.sz/4, this.sz);
		} else if (viz == 6){
			ctx.fillStyle = this.c;
			ctx.fillRect(sticky(this.x,this.sz), sticky(this.y,this.sz), this.sz, this.sz);
		} else if (viz == 7){
			ctx.fillStyle = this.c;
			ctx.LfillEllipse(this.x, this.y, this.sz, this.sz);
		} else if (viz == 8 && this.show){
			ctx.font = "10px Arial";
			ctx.fillStyle = this.c;
			ctx.centreFillRect(sticky(this.x, this.sticky_sz), sticky(this.y, this.sticky_sz), this.sticky_sz, this.sticky_sz);
			ctx.fillStyle = "#333";
			ctx.fillText(this.day, sticky(this.x, this.sticky_sz) -2.5, sticky(this.y, this.sticky_sz) + 3.2);
		}

	}

}



function twirl(){

  if (chance(20)) {
    change  = simplex.noise3D(x1, y1, tm) * 0.0005;
  }

  curve += change;
  tm+= curve;

  x2 = x1, y2 = y1;

  var noise = simplex3(
    x1 * config.simplexScale,
    y1 * config.simplexScale,
    lines.length * config.simplexDepthScale
  )

  var theta = noise * Math.PI * 2;

  x1 = x1 + Math.cos( tm ) * config.lineLength;
  y1 = y1 + Math.sin( tm ) * config.lineLength

  if (x1>w) resetLine();
  if (x1<0) resetLine();
  if (y1>h) resetLine();
  if (y1<0) resetLine();

	curr_line_width = 6 * Math.sin(linecount/60);

	linecount++;
  ctx.lineWidth = curr_line_width;
  ctx.strokeStyle = s;

  selfHit();

  if (!checkHit()) {
  	ctx.line(x1, y1, x2, y2);;
  	var l = {
    	x: x1, y: y1
  	}
  	lines.push(l);
  }
}


function chooseIcon(d){

	var icon = '../img/red_cross.png';

	if(viz == 7){
		var dt = d.DATE + " " + d.TIME;
		if(isDay(dt)) {
			icon = '../img/blue_cross.png';
		} else {
			icon = '../img/yellow_cross.png';
		}

	} else if (viz == 6 || viz == 2){
		if(pedestrians_killed > 0) {
			icon = '../img/pink_cross.png';
		} else if(cyclists_killed > 0) {
			icon = '../img/green_cross.png';
		} else if(motorists_killed > 0) {
			icon = '../img/blue_cross2.png';
		}

	} else if (viz == 4) {
	 icon = '../img/cross.png';

	}

	return icon;

}


function addMarker(d, i){

				c++;

				var accidentLatlng = new google.maps.LatLng(d.LATITUDE, d.LONGITUDE);
				var txt = makeInfoWindowContent(d);

				var icon = chooseIcon(d);

				if (viz != 8) {
					var marker = markers[total_deaths];
					marker = new google.maps.Marker({
		    		position: accidentLatlng,
						icon: icon,
						map: gmap,
						animation: google.maps.Animation.DROP,
					});
					markers.push(marker);
					google.maps.event.addListener(marker, 'mouseover', (function(marker, i) {

		 			return function() {
				 	infoWindow.setContent(makeInfoWindowContent(d));
				 	infoWindow.open(gmap, marker);
					}

	})(marker, i));


	google.maps.event.addListener(marker, 'mouseout', (function(marker, i) {
	 return function() {
			 infoWindow.setContent(makeInfoWindowContent(data[i]));
			 infoWindow.close(gmap, marker);
	 }
	})(marker, i));
	}
}


 $("input[type=checkbox]").change(function(e){

	 var target = e.target.id;

	 if(target == "all_accidents"){
	 	if($('#all_accidents').is(':checked')) {
		 	turnAllChecked(true);
			turnMain(true);
			turnSubs("injured", true);
			turnSubs("killed", true);
			turnDays(true);
	 } else if(target == "all_accidents" ) {
		 	turnAllChecked(false);
		 	turnSubs("injured", false);
			turnSubs("killed", false);
			turnMain(false);
			turnDays(false);
	 }
}
	if(target == "total_injured" && $('#total_injured').is(':checked')) {
		turnSubs("injured", true);
	}

	if(target == "total_injured" && !$('#total_injured').is(':checked')) {
		$('#all_accidents').prop( "checked", false );
		turnSubs("injured", false);
	}

	if(target == "total_killed" && $('#total_killed').is(':checked')) {
		turnSubs("killed", true);
	}

	if(target == "total_killed" && !$('#total_killed').is(':checked')) {
		$('#all_accidents').prop( "checked", false );
		turnSubs("killed", false);
	}

	if(target == "ok_checked" && $('#ok_checked').is(':checked')) {
		$('#all_accidents').prop( "checked", true );
	}

	if(target == "ok_checked" && !$('#ok_checked').is(':checked')) {
		$('#all_accidents').prop( "checked", false );
	}

	if((target == "total_injured" || target == "total_killed" || target == "ok_checked") && ($('#total_injured').is(':checked') && $('#total_killed').is(':checked') && $('#ok_checked').is(':checked'))) {
		$('#all_accidents').prop( "checked", true );
		turnMain(true);
		turnSubs("injured", true);
		turnSubs("killed", true);

	}

	if(target == "pedestrians_checked") {

			if($('#pedestrians_checked').is(':checked')) {
				$('#pedestrians_injured').prop( "checked", true );
				$('#pedestrians_killed').prop( "checked", true );
			} else {
				$('#pedestrians_injured').prop( "checked", false );
				$('#pedestrians_killed').prop( "checked", false );
				turnOffAllChecked();
			}

	}

	if(target == "pedestrians_injured" || target == "pedestrians_killed"){

			if ($('#pedestrians_injured').is(':checked') && $('#pedestrians_killed').is(':checked') ){
				$('#pedestrians_checked').prop( "checked", true );
		} else if( !$('#pedestrians_injured').is(':checked') || !$('#pedestrians_killed').is(':checked')) {
				$('#pedestrians_checked').prop( "checked", false );
				turnOffAllChecked()
		}
	}



if(target == "cyclists_checked") {

		if($('#cyclists_checked').is(':checked')) {
			$('#cyclists_injured').prop( "checked", true );
			$('#cyclists_killed').prop( "checked", true );
		} else {
			$('#cyclists_injured').prop( "checked", false );
			$('#cyclists_killed').prop( "checked", false );
			turnOffAllChecked();
		}

}

if(target == "cyclists_injured" || target == "cyclists_killed"){

		if ($('#cyclists_injured').is(':checked') && $('#cyclists_killed').is(':checked') ){
			$('#cyclists_checked').prop( "checked", true );
	} else if( !$('#cyclists_injured').is(':checked') || !$('#cyclists_killed').is(':checked')) {
			$('#cyclists_checked').prop( "checked", false );
			turnOffAllChecked()
	}
}


if(target == "motorists_checked") {

		if($('#motorists_checked').is(':checked')) {
			$('#motorists_injured').prop( "checked", true );
			$('#motorists_killed').prop( "checked", true );
		} else {
			$('#motorists_injured').prop( "checked", false );
			$('#motorists_killed').prop( "checked", false );
			turnOffAllChecked();

		}

}

if(target == "motorists_injured" || target == "motorists_killed"){

		if ($('#motorists_injured').is(':checked') && $('#motorists_killed').is(':checked') ){
			$('#motorists_checked').prop( "checked", true );
	} else if( !$('#motorists_injured').is(':checked') || !$('#motorists_killed').is(':checked')) {
			$('#motorists_checked').prop( "checked", false );
			turnOffAllChecked()
	}
}



	if(target == "days_checked") {

			if($('#days_checked').is(':checked')) {
				turnDays(true);
			} else {
				turnDays(false);
			}

	}


	if(target == "mon_check" || target == "tues_check" || target == "wed_check" || target == "thurs_check" || target == "fri_check" || target == "sat_check" || target == "sun_check"){

		if ($('#mon_check').is(':checked') && $('#tues_check').is(':checked') && $('#wed_check').is(':checked') && $('#thurs_check').is(':checked') && $('#fri_check').is(':checked') && $('#sat_check').is(':checked') && $('#sun_check').is(':checked') ){
				$('#days_checked').prop( "checked", true );
		} else if (!$('#mon_check').is(':checked') || !$('#tues_check').is(':checked') || !$('#wed_check').is(':checked') || !$('#thurs_check').is(':checked') || !$('#fri_check').is(':checked') || !$('#sat_check').is(':checked') || !$('#sun_check').is(':checked') ){
			$('#days_checked').prop( "checked", false );
			turnOffAllChecked()
		}
}

	if($('#pedestrians_checked').is(':checked') && $('#cyclists_checked').is(':checked') && $('#motorists_checked').is(':checked') && $('#days_checked').is(':checked')  ) {
		$('#all_accidents').prop( "checked", true );
		turnAllChecked(true)
	}

	 filter();
 })




function selfHit(){
  if (lines.length > 0) {

    for (var i = 1; i < lines.length; i++) {

      hit = checkIntersection(x1, y1, x2, y2, lines[i].x, lines[i].y, lines[i-1].x, lines[i-1].y );

      if (hit!= undefined && hit!= false) {
        resetLine();
        break;
      }
  }

  }
}





function checkHit(){
    var is_hit = false;
    //if (active_lines.length > 0) {
    for (var j = 0; j < active_lines.length; j++) {
    var lines2 = active_lines[j];
    if (lines2.length > 0) {

			for (var i = 1; i < lines2.length; i++) {

      hit = checkIntersection(x1, y1, x2, y2, lines2[i].x, lines2[i].y, lines2[i-1].x, lines2[i-1].y );

      if (hit!= undefined && hit!= false) {

        resetLine();
        is_hit = true;
        break;
      }
  }

  }
}

return is_hit;

}


function addHeatmap(){
	console.log("addHeatmap");

	heatmapData = new google.maps.MVCArray();
	heatmap = new google.maps.visualization.HeatmapLayer({
			data: heatmapData,
			opacity: 0.7,
			//dissipating: false,
			maxIntensity: 50,
			radius: 25,
			gradient: gradient
	});

	heatmap.setMap(gmap);
}



function updateUI(d){

	var dt = d.TIME + " " + d.DATE;

	var full_date = getDate(d.TIME + " " + d.DATE, 1);

	//console.log(dt + " : " + full_date);

	if (start_date == "") start_date = full_date;

	$('#date_holder').html("<b>A Month of New York Traffic Accidents</b><br> " + start_date + " - <br>" + full_date + " ");

  $('#all .total .count').html(counter);
	$('#all .ok .count').html(total_injured);
	$('#all .injured .count').html(total_injured);
	$('#all .killed .count').html(total_deaths);

	$('#pedestrians .injured .count').html(total_pedestrians_injured);
	$('#pedestrians .killed .count').html(total_pedestrians_deaths);

	$('#cyclists .injured .count').html(total_cyclists_injured);
	$('#cyclists .killed .count').html(total_cyclists_deaths);

	$('#motorists .injured .count').html(total_motorists_injured);
	$('#motorists .killed .count').html(total_motorists_deaths);

	addDay(d);

  if(killed == 0) {
    $('#all .killed .bullet').removeClass('active');
  } else {
    $('#all .killed .bullet').addClass('active');
  }

  if(injured == 0) {
    $('#all .injured .bullet').removeClass('active');
  } else {
    $('#all .injured .bullet').addClass('active');
  }

	if(ok == 0) {
		$('#all .ok .bullet').removeClass('active');
	} else {
		$('#all .ok .bullet').addClass('active');
	}

  if(pedestrians_injured == 0) {
    $('#pedestrians .injured .bullet').removeClass('active');
  } else {
    $('#pedestrians .injured .bullet').addClass('active');
  }

	if(pedestrians_killed == 0) {
    $('#pedestrians .killed .bullet').removeClass('active');
  } else {
    $('#pedestrians .killed .bullet').addClass('active');
  }

	if(cyclists_injured == 0) {
    $('#cyclists .injured .bullet').removeClass('active');
  } else {
    $('#cyclists .injured .bullet').addClass('active');
  }

  if(cyclists_killed == 0) {
    $('#cyclists .killed .bullet').removeClass('active');
  } else {
    $('#cyclists .killed .bullet').addClass('active');
  }

	if(motorists_injured == 0) {
		$('#motorists .injured .bullet').removeClass('active');
  } else {
		$('#motorists .injured .bullet').addClass('active');
  }

  if(motorists_killed == 0) {
		$('#motorists .killed .bullet').removeClass('active');
  } else {
		$('#motorists .killed .bullet').addClass('active');
  }


}


function getDayType(dt){
	if(isDay(dt)) {
		return day_type = "day";
	} else {
		return day_type = "night";
	}
}

function getDayNumber(dt){
	var current_date = new Date(dt);
	return parseInt(current_date.getDay());
}


function addDay(d){

	var dt = d.TIME + " " + d.DATE;
	var day_type = getDayType(dt);
	var day_number = getDayNumber(dt);


	$('#days .mon .count').html(monday);
	$('#days .tues .count').html(tuesday);
	$('#days .wed .count').html(wednesday);
	$('#days .thurs .count').html(thursday);
	$('#days .fri .count').html(friday);
	$('#days .sat .count').html(saturday);
	$('#days .sun .count').html(sunday);

	$('#days .day .bullet').removeClass('active');
	$('#days .night .bullet').removeClass('active');
	$('#days .mon .bullet').removeClass('active');
	$('#days .tues .bullet').removeClass('active');
	$('#days .wed .bullet').removeClass('active');
	$('#days .thurs .bullet').removeClass('active');
	$('#days .fri .bullet').removeClass('active');
	$('#days .sat .bullet').removeClass('active');
	$('#days .sun .bullet').removeClass('active');

	if(frameCount%2 == 0) {

		if (isDay(dt)) {
			$('#days .day .bullet').addClass('active');
		} else {
			$('#days .night .bullet').addClass('active');
		}

		if (day_number == 1) {
			monday++;
			$('#days .mon .bullet').addClass('active');
		}
		if (day_number == 2) {
			tuesday++;
			$('#days .tues .bullet').addClass('active');
		}
		if (day_number == 3) {
			wednesday++;
			$('#days .wed .bullet').addClass('active');
		}
		if (day_number == 4) {
			thursday++;
			$('#days .thurs .bullet').addClass('active');}
		if (day_number == 5) {
			friday++;
			$('#days .fri .bullet').addClass('active');}
		if (day_number == 6) {
			saturday++;
			$('#days .sat .bullet').addClass('active');}
		if (day_number == 7 || day_number == 0) {
			sunday++;
			$('#days .sun .bullet').addClass('active');}

	}
}


function makeInfoWindowContent(d){

	var dt = getDate(d.TIME + " " + d.DATE, 1);

	var txt = '<div class="info_content" class="text-center">';
	txt += "<div class='info_date'>" + dt + "</div>";
	txt += "<h3>"
	if(d['BOROUGH'] != "") txt += d.BOROUGH;
	if(d['CROSS STREET NAME'] != "") txt += ": " + d['CROSS STREET NAME'];
	txt +="</h3>";


	txt += "<div class='info_injuries half-top'>";

	txt += "<span style='color:" + pedestrian_colour + "'>";
	if(d['NUMBER OF PEDESTRIANS INJURED'] != undefined && parseInt(d['NUMBER OF PEDESTRIANS INJURED']) != 0) {
		txt += "Cyclists Injured: " + d['NUMBER OF PEDESTRIANS INJURED'] + ". ";
	}

	if(d['NUMBER OF PEDESTRIANS KILLED'] != undefined && parseInt(d['NUMBER OF PEDESTRIANS KILLED']) != 0) {
		txt += "Pedestrians Killed: " + d['NUMBER OF PEDESTRIANS KILLED'] + ".<br>";
	}
	txt += "</span>";

	txt += "<span style='color:" + cyclist_colour + "'>";

	if(d['NUMBER OF CYCLIST INJURED'] != undefined && parseInt(d['NUMBER OF CYCLIST INJURED']) != 0) {
		txt += "Cyclists Injured: " + d['NUMBER OF CYCLIST INJURED'] + ". ";
	}

	if(d['NUMBER OF CYCLIST KILLED'] != undefined && parseInt(d['NUMBER OF CYCLIST KILLED']) != 0) {
		txt += "Cyclists Killed: " +d['NUMBER OF CYCLIST KILLED'] + ".<br>";
	}
	txt += "</span>";

	txt += "<span style='color:" + motorist_colour + "'>";

	if(d['NUMBER OF MOTORIST INJURED'] != undefined && parseInt(d['NUMBER OF MOTORIST INJURED']) != 0) {
		txt += "Motorists Injured: " +d['NUMBER OF MOTORIST INJURED'] + ". ";
	}

	if(d['NUMBER OF MOTORIST KILLED'] != undefined && parseInt(d['NUMBER OF MOTORIST KILLED']) != 0) {
		txt += "Motorists Killed: " + d['NUMBER OF MOTORIST KILLED'] + ".<br>";
	}
	txt += "</span>";



	if(d["CONTRIBUTING FACTOR VEHICLE 1"] != "" && d["CONTRIBUTING FACTOR VEHICLE 2"] != "") {
		txt +="<h4 class='half-top'>Contributing Factors: ";
		if(d["CONTRIBUTING FACTOR VEHICLE 1"] != "" && d["CONTRIBUTING FACTOR VEHICLE 1"] != "Unspecified") txt += d["CONTRIBUTING FACTOR VEHICLE 1"] + ". ";
		if(d["CONTRIBUTING FACTOR VEHICLE 2"] != "" && d["CONTRIBUTING FACTOR VEHICLE 2"] != "Unspecified") txt += d["CONTRIBUTING FACTOR VEHICLE 2"] + ". ";
		txt +="</h4>";
	}


	txt +='</div>';
	//console.log(txt);
	return txt;
;
}


//////////// UTILS

function getLocs(d, totals){

		var totals = totals || 1;
			var loc = new google.maps.LatLng(d.LATITUDE, d.LONGITUDE);
			var px = fromLatLngToPixel(loc);

	return px;
}


function resetMap(){
		ctx.clearRect(0,0,w,h);
		heatmapData = [];
		particles = [];
		counter = 0;
		active_lines = [];
		line = [];
		total_pedestrians_injured = 0, total_pedestrians_deaths = 0;
		total_cyclists_injured = 0, total_cyclists_deaths = 0;
		total_motorists_injured = 0, total_motorists_deaths = 0;
		total_deaths = 0, total_injured = 0;
		monday = 0, tuesday = 0, wednesday = 0, thursday = 0, friday = 0, saturday = 0, sunday = 0;

		for (var i = 0; i < markers.length; i++) {
			markers[i].setMap(null);
		}

		markers = [];
		if(heatmap) heatmap.setMap(null);

}




function turnMain(val){
	$('#motorists_checked').prop( "checked", val );
	$('#cyclists_checked').prop( "checked", val );
	$('#pedestrians_checked').prop( "checked", val );
	filter_pedestrian = val;
	filter_cyclist = val;
	filter_motorist = val;
}


function turnOffAllChecked(){
	$('#all_accidents').prop( "checked", false );
	turnAllChecked(false)
}



	function turnDays(val){
		$('#mon_check').prop( "checked", val );
		$('#tues_check').prop( "checked", val );
		$('#wed_check').prop( "checked", val );
		$('#thurs_check').prop( "checked", val );
		$('#fri_check').prop( "checked", val );
		$('#sat_check').prop( "checked", val );
		$('#sun_check').prop( "checked", val );
		$('#days_checked').prop( "checked", val );
	}

 function turnAllChecked(val){
 	$('#total_injured').prop( "checked", val );
 	$('#total_killed').prop( "checked", val );
 	$('#ok_checked').prop( "checked", val );
	if(val == true) {
		turnMain(true);
		turnSubs("injured", true);
		turnSubs("killed", true);
	}
 }


 function turnSubs(type, val){
 	$('#motorists_' + type).prop( "checked", val );
 	$('#cyclists_' + type).prop( "checked", val );
 	$('#pedestrians_' + type).prop( "checked", val );
	if(val == false) {
		turnMain(false);
	}
 }



 function fromLatLngToPixel(position) {

   var scale = Math.pow(2, gmap.getZoom());
   var proj = gmap.getProjection();
   var bounds = gmap.getBounds();

   var nw = proj.fromLatLngToPoint(
     new google.maps.LatLng(
       bounds.getNorthEast().lat(),
       bounds.getSouthWest().lng()
     ));
   var point = proj.fromLatLngToPoint(position);

   return new google.maps.Point(
     Math.floor((point.x - nw.x) * scale),
     Math.floor((point.y - nw.y) * scale));
 }


 function deleteMarkers(){
 	for (var i = 0; i < markers.length; i++) {
 		markers[i].setMap(null);
 	}
 	markers = [];
 }

 var viz_types = document.viz_selector.group1;
	 //var prev = null;
	 for(var i = 0; i < viz_types.length; i++) {
			 viz_types[i].onclick = function() {
					 viz = this.value;
					 filter();
					 //console.log(this.value)
			 };
	 }

	 function addHeatMapData(d, total){
	 	//console.log("addHeatMapData");
	 	var loc = new google.maps.LatLng(d.LATITUDE, d.LONGITUDE);
	 	for (var i = 0; i < total; i++) {
	 		heatmapData.push(loc);
	 	}
	 	var px = fromLatLngToPixel(loc);
	 	ctx.fillStyle = "red";
	 	ctx.cross(px.x, px.y, 2, 8);
	 }



	 window.onload = function(){

	 	var location = {
	         "lat": 40.7090,
	         "lng": -73.75
	     };

	 	var myLatlng = new google.maps.LatLng(location.lat, location.lng);

	 	var mapOptions = {
	 		zoom: 11,
	 		styles: dark,
	 		center: myLatlng,
	 		mapTypeId: google.maps.MapTypeId.ROAD,
	 		disableDefaultUI: false,
	 		scrollwheel: true,
	 		draggable: true,
	 		navigationControl: false,
	 		mapTypeControl: false,
	 		scaleControl: true,
	 		streetViewControl: false,
	 		zoomControl: true,
	 		zoomControlOptions: {
	               position: google.maps.ControlPosition.LEFT_BOTTOM
	           },
	 		disableDoubleClickZoom: false
	 	};

	 	gmap = new google.maps.Map(document.getElementById("map"), mapOptions);

	 	// initialize the canvasLayer
	 	var canvasLayerOptions = {
	 		map: gmap,
	 		resizeHandler: resize,
	 		animate: true,
	 		updateHandler: draw,
	 		resolutionScale: resolutionScale
	 	};
	 	canvasLayer = new CanvasLayer(canvasLayerOptions);
	 	ctx = canvasLayer.canvas.getContext('2d');

	 	ctx.font = "18px Monospace";
	 	ctx.textAlign = "center";
	 	ctx.moveTo(w/2, h/2);
	 	ctx.beginPath();
	 	ctx.lineCap = 'round';
	 	ctx.lineWidth = 2;

	 	google.maps.event.addListener(gmap, "drag", function(){
	 		if(viz !=4) resetMap();
	 	});

	 	google.maps.event.addListener(gmap, "zoom_changed", function(){
	 		if(viz !=4) resetMap();
	 	});

	 	google.maps.event.addListenerOnce(gmap, "idle", function(){

	 		mapLoaded = true;
	 		ctx.clearRect(0, 0, w, h);

	 		d3.csv(url, function(_data) {

	 		  data = _data;
	 		  //data.reverse();
				filter();
	 			resetLine();

	 		});

	 });

	 };



	 $('.close').on('click',function(){
	 	$('.holder').toggleClass('hidden');
	 	if($('.holder').hasClass('hidden')) {
	 		$('.close').html("+");
	 	} else {
	 		$('.close').html("x");
	 	}
	 })


	 $('.circle').on('click',function(){

	   var animClass = $(this).data('animation');
	   var removeTime = $(this).data('remove');

	 	if($(this).hasClass(animClass)){
	      $(this).removeClass(animClass);
	   }else{
	     $(this).addClass(animClass);
	     if(typeof removeTime != 'undefined'){
	       var el = $(this);
	        setTimeout(function(){
	          el.removeClass(animClass);
	        },removeTime);
	     }
	   }

	 });



	 function restyleMap(){


	 	if(tt == "day") {
	 		t = day_start;
	 		gmap.setOptions({styles: light});
	 		$('.holder').addClass('day');
	 	} else if(tt == "night") {
	 		t = night_start;
	 		$('.holder').removeClass('day');
	 		gmap.setOptions({styles: night});
	 	} else {
	 		t = "any";
	 		gmap.setOptions({styles: dark});
	 	}

	 }

</script>




</body>
</html>
